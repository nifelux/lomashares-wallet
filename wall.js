(function () {  const username = document.getElementById("userData").dataset.username;  if (!username) {    alert("User not detected");    return;  }  const WALLET_KEY = "lomashares_wallet_" + username;  function getWallet() {    return JSON.parse(localStorage.getItem(WALLET_KEY)) || {      approved: 0,      pending: 0,      txs: []    };  }  function saveWallet(w) {    localStorage.setItem(WALLET_KEY, JSON.stringify(w));    render();  }  function render() {    const w = getWallet();    document.getElementById("approved").innerText = w.approved.toLocaleString();    document.getElementById("pending").innerText = w.pending.toLocaleString();    document.getElementById("withdrawBtn").disabled = w.approved < 1000;    let html = "";    w.txs.forEach(t => {      html += &grave;        <div class="tx">          <strong>${t.type}</strong> ₦${t.amount.toLocaleString()}<br>          <small>${t.ref}</small><br>          <span class="status ${t.status.toLowerCase()}">${t.status}</span>        </div>      &grave;;    });    document.getElementById("transactions").innerHTML =      html || "<p>No transactions yet</p>";  }  window.pay = function () {    const amount = Number(document.getElementById("amount").value);    if (amount < 100) {      alert("Minimum deposit is ₦100");      return;    }    const ref = "LS-" + Date.now();    PaystackPop.setup({      key: "pk_live_cd8547f6b4270551729c247d8d31635691c39a08",      amount: amount * 100,      email: username + "@lomashares.com",      currency: "NGN",      ref: ref,      callback: function () {        const w = getWallet();        w.pending += amount;        w.txs.unshift({          type: "Deposit",          amount: amount,          ref: ref,          status: "Pending"        });        saveWallet(w);        alert("Deposit submitted. Awaiting admin approval.");      }    }).openIframe();  };  window.withdraw = function () {    const w = getWallet();    const amount = Number(prompt("Enter withdrawal amount (₦)"));    if (!amount || amount < 1000) {      alert("Minimum withdrawal is ₦1,000");      return;    }    if (amount > w.approved) {      alert("Insufficient balance");      return;    }    w.approved -= amount;    w.txs.unshift({      type: "Withdrawal",      amount: amount,      ref: "WD-" + Date.now(),      status: "Pending"    });    saveWallet(w);    alert("Withdrawal request submitted");  };  render();})();
